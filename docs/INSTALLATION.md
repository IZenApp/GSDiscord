# Руководство по установке

## Подробная инструкция по настройке GSDiscord бота

### Шаг 1: Подготовка системы

#### Установка Node.js

**macOS (с Homebrew):**
```bash
# Установка Homebrew (если не установлен)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Установка Node.js
brew install node

# Проверка версии
node --version
npm --version
```

**Linux (Ubuntu/Debian):**
```bash
# Обновление пакетов
sudo apt update

# Установка Node.js и npm
sudo apt install nodejs npm

# Проверка версии
node --version
npm --version
```

**Windows:**
1. Скачайте установщик с [официального сайта Node.js](https://nodejs.org/)
2. Запустите установщик и следуйте инструкциям
3. Откройте командную строку и проверьте установку:
   ```cmd
   node --version
   npm --version
   ```

### Шаг 2: Настройка Google Cloud Platform

1. **Создание проекта:**
   - Перейдите в [Google Cloud Console](https://console.cloud.google.com/)
   - Нажмите "Создать проект"
   - Введите название проекта
   - Нажмите "Создать"

2. **Включение Google Sheets API:**
   - В меню выберите "API и сервисы" → "Библиотека"
   - Найдите "Google Sheets API"
   - Нажмите "Включить"

3. **Создание Service Account:**
   - Перейдите в "API и сервисы" → "Учетные данные"
   - Нажмите "Создать учетные данные" → "Аккаунт службы"
   - Введите имя аккаунта службы
   - Нажмите "Создать и продолжить"
   - Назначьте роль "Редактор" (или минимально необходимые права)
   - Нажмите "Готово"

4. **Скачивание ключей:**
   - В списке аккаунтов службы нажмите на созданный аккаунт
   - Перейдите на вкладку "Ключи"
   - Нажмите "Добавить ключ" → "Создать новый ключ"
   - Выберите формат JSON
   - Сохраните файл

### Шаг 3: Подготовка Google Sheets

1. **Создание таблицы:**
   - Откройте [Google Sheets](https://sheets.google.com/)
   - Создайте новую таблицу
   - Скопируйте ID таблицы из URL (между `/d/` и `/edit`)

2. **Предоставление доступа:**
   - Нажмите "Поделиться" в правом верхнем углу
   - Добавьте email адрес вашего Service Account
   - Предоставьте права "Редактор" или "Читатель"

3. **Структура данных:**
   - Разместите заголовки в строке 1, столбцы C-F
   - Данные должны начинаться со строки 2
   - Пример структуры:
     ```
     | C        | D      | E     | F       |
     |----------|--------|-------|---------|
     | Имя      | Email  | Тема  | Сообщение|
     | Иван     | ivan@  | Тест  | Привет   |
     ```

### Шаг 4: Настройка Discord

1. **Создание вебхука:**
   - Откройте настройки канала Discord
   - Перейдите в "Интеграции"
   - Нажмите "Создать вебхук"
   - Скопируйте URL вебхука

### Шаг 5: Установка и запуск

1. **Клонирование проекта:**
   ```bash
   git clone https://github.com/IZenApp/GSDiscord.git
   cd GSDiscord
   ```

2. **Установка зависимостей:**
   ```bash
   npm install
   ```

3. **Настройка:**
   ```bash
   npm run setup
   ```
   Следуйте инструкциям и введите:
   - ID Google Sheets
   - URL Discord webhook

4. **Размещение учетных данных:**
   ```bash
   # Скопируйте скачанный JSON файл
   cp path/to/your/credentials.json credentials/google-credentials.json
   ```

5. **Проверка конфигурации:**
   ```bash
   npm run validate
   ```

6. **Запуск:**
   ```bash
   npm start
   ```

## Возможные проблемы и решения

### Ошибка аутентификации Google

**Проблема:** `Error: ENOENT: no such file or directory`

**Решение:**
- Убедитесь, что файл `credentials/google-credentials.json` существует
- Проверьте права доступа к файлу
- Убедитесь, что Service Account имеет доступ к таблице

### Ошибка Discord webhook

**Проблема:** `Error 404 Not Found`

**Решение:**
- Проверьте корректность URL webhook
- Убедитесь, что вебхук не был удален
- Проверьте права бота в канале

### Проблемы с доступом к Google Sheets

**Проблема:** `Error: The caller does not have permission`

**Решение:**
- Добавьте email Service Account в настройки доступа к таблице
- Убедитесь, что Google Sheets API включен в проекте
- Проверьте правильность ID таблицы

## Полезные команды

```bash
# Просмотр логов
tail -f logs/$(date +%Y-%m-%d).log

# Остановка бота
Ctrl + C (или Cmd + C на macOS)

# Проверка процессов Node.js
ps aux | grep node

# Очистка логов
npm run clean
```
